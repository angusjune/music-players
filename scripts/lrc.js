var Lrc=function(){function t(t){for(var i=0,e=this.lines.length;e>i&&!(t<=this.lines[i].time);i++);return i}function i(t){this.handler.call(this,this.lines[t].txt,{originLineNum:this.lines[t].originLineNum,lineNum:t})}Date.now=Date.now||(new Date).getTime;var e=/\[(\d{2,})\:(\d{2})(?:\.(\d{2,3}))?\]/g,s={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"},n=function(t,i){t=n.trim(t),this.lrc=t,this.handler=i||function(){},this.tags={},this.lines=[],this.txts=[],this.isLrc=n.isLrc(t),this.curLine=0,this.state=0;var r,a,u,l,o=t.split(/\n/);for(var c in s)r=t.match(new RegExp("\\["+s[c]+":([^\\]]*)\\]","i")),this.tags[c]=r&&r[1]||"";e.lastIndex=0;for(var h=0,m=o.length;m>h;h++)for(;u=e.exec(o[h]);)l=e.lastIndex,a=n.trim(o[h].replace(e,"")),e.lastIndex=l,this.lines.push({time:60*u[1]*1e3+1e3*u[2]+10*(u[3]||0),originLineNum:h,txt:a}),this.txts.push(a);this.lines.sort(function(t,i){return t.time-i.time})};return n.prototype={play:function(e,s){var n=this;e=e||0,n._startStamp=Date.now()-e,n.state=1,n.isLrc&&(n.curLine=t.call(n,e),s||n.curLine&&i.call(n,n.curLine-1),n.curLine<n.lines.length&&(clearTimeout(n._timer),n._timer=setTimeout(function r(){i.call(n,n.curLine++),n.lines[n.curLine]&&(n._timer=setTimeout(function(){r()},n.lines[n.curLine].time-(Date.now()-n._startStamp)))},n.lines[n.curLine].time-e)))},pauseToggle:function(){var t=Date.now();this.state?(this.stop(),this._pauseStamp=t):(this.play((this._pauseStamp||t)-(this._startStamp||t),!0),delete this._pauseStamp)},seek:function(t){this._startStamp-=t,this.state&&this.play(Date.now()-this._startStamp)},stop:function(){this.state=0,clearTimeout(this._timer)}},n.trim=function(t){return t.replace(/(^\s*|\s*$)/m,"")},n.isLrc=function(t){return e.test(t)},n}();"undefined"!=typeof module&&this.module!==module&&(module.exports.Lrc=Lrc);